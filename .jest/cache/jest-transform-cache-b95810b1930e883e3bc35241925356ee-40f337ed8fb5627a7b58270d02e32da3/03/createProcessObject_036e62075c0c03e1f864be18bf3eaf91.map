{"version":3,"names":["Object","defineProperty","exports","value","default","createProcessObject","_deepCyclicCopy","_interopRequireDefault","require","obj","__esModule","BLACKLIST","Set","isWin32","process","platform","proto","getPrototypeOf","env","createProcessEnv","real","create","lookup","deletePropertyWin32","_target","key","name","prototype","hasOwnProperty","call","toLowerCase","deleteProperty","getProperty","getPropertyWin32","proxy","Proxy","get","set","strValue","newProcess","blacklist","keepPrototype","Symbol","toStringTag","e","message","constructor","send","domain"],"sources":["createProcessObject.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = createProcessObject;\n\nvar _deepCyclicCopy = _interopRequireDefault(require('./deepCyclicCopy'));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {default: obj};\n}\n\n/**\n * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nconst BLACKLIST = new Set(['env', 'mainModule', '_events']);\nconst isWin32 = process.platform === 'win32';\nconst proto = Object.getPrototypeOf(process.env); // The \"process.env\" object has a bunch of particularities: first, it does not\n// directly extend from Object; second, it converts any assigned value to a\n// string; and third, it is case-insensitive in Windows. We use a proxy here to\n// mimic it (see https://nodejs.org/api/process.html#process_process_env).\n\nfunction createProcessEnv() {\n  const real = Object.create(proto);\n  const lookup = {};\n\n  function deletePropertyWin32(_target, key) {\n    for (const name in real) {\n      if (Object.prototype.hasOwnProperty.call(real, name)) {\n        if (typeof key === 'string') {\n          if (name.toLowerCase() === key.toLowerCase()) {\n            delete real[name];\n            delete lookup[name.toLowerCase()];\n          }\n        } else {\n          if (key === name) {\n            delete real[name];\n            delete lookup[name];\n          }\n        }\n      }\n    }\n\n    return true;\n  }\n\n  function deleteProperty(_target, key) {\n    delete real[key];\n    delete lookup[key];\n    return true;\n  }\n\n  function getProperty(_target, key) {\n    return real[key];\n  }\n\n  function getPropertyWin32(_target, key) {\n    if (typeof key === 'string') {\n      return lookup[key in proto ? key : key.toLowerCase()];\n    } else {\n      return real[key];\n    }\n  }\n\n  const proxy = new Proxy(real, {\n    deleteProperty: isWin32 ? deletePropertyWin32 : deleteProperty,\n    get: isWin32 ? getPropertyWin32 : getProperty,\n\n    set(_target, key, value) {\n      const strValue = `${value}`;\n\n      if (typeof key === 'string') {\n        lookup[key.toLowerCase()] = strValue;\n      }\n\n      real[key] = strValue;\n      return true;\n    }\n  });\n  return Object.assign(proxy, process.env);\n}\n\nfunction createProcessObject() {\n  const process = require('process');\n\n  const newProcess = (0, _deepCyclicCopy.default)(process, {\n    blacklist: BLACKLIST,\n    keepPrototype: true\n  });\n\n  try {\n    // This fails on Node 12, but it's already set to 'process'\n    newProcess[Symbol.toStringTag] = 'process';\n  } catch (e) {\n    // Make sure it's actually set instead of potentially ignoring errors\n    if (newProcess[Symbol.toStringTag] !== 'process') {\n      e.message = `Unable to set toStringTag on process. Please open up an issue at https://github.com/facebook/jest\\n\\n${e.message}`;\n      throw e;\n    }\n  } // Sequentially execute all constructors over the object.\n\n  let proto = process;\n\n  while ((proto = Object.getPrototypeOf(proto))) {\n    if (typeof proto.constructor === 'function') {\n      proto.constructor.call(newProcess);\n    }\n  }\n\n  newProcess.env = createProcessEnv();\n\n  newProcess.send = () => true;\n\n  Object.defineProperty(newProcess, 'domain', {\n    get() {\n      return process.domain;\n    }\n  });\n  return newProcess;\n}\n"],"mappings":"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"}