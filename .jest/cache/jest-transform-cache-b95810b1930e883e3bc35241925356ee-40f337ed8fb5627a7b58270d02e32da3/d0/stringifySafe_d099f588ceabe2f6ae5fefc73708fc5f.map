{"version":3,"names":["createStringifySafeWithLimits","limits","maxDepth","Number","POSITIVE_INFINITY","maxStringLimit","maxArrayLimit","maxObjectKeysLimit","stack","replacer","key","value","length","shift","truncatedString","substring","retval","Array","isArray","slice","concat","invariant","keys","Object","k","truncatedKey","unshift","stringifySafe","arg","undefined","toString","e","Error","name","message","ret","JSON","stringify","E"],"sources":["stringifySafe.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow strict\n */\n\nimport invariant from 'invariant';\n\n/**\n * Tries to stringify with JSON.stringify and toString, but catches exceptions\n * (e.g. from circular objects) and always returns a string and never throws.\n */\nexport function createStringifySafeWithLimits(limits: {|\n  maxDepth?: number,\n  maxStringLimit?: number,\n  maxArrayLimit?: number,\n  maxObjectKeysLimit?: number,\n|}): mixed => string {\n  const {\n    maxDepth = Number.POSITIVE_INFINITY,\n    maxStringLimit = Number.POSITIVE_INFINITY,\n    maxArrayLimit = Number.POSITIVE_INFINITY,\n    maxObjectKeysLimit = Number.POSITIVE_INFINITY,\n  } = limits;\n  const stack = [];\n  function replacer(key: string, value: mixed): mixed {\n    while (stack.length && this !== stack[0]) {\n      stack.shift();\n    }\n\n    if (typeof value === 'string') {\n      const truncatedString = '...(truncated)...';\n      if (value.length > maxStringLimit + truncatedString.length) {\n        return value.substring(0, maxStringLimit) + truncatedString;\n      }\n      return value;\n    }\n    if (typeof value !== 'object' || value === null) {\n      return value;\n    }\n\n    let retval = value;\n    if (Array.isArray(value)) {\n      if (stack.length >= maxDepth) {\n        retval = `[ ... array with ${value.length} values ... ]`;\n      } else if (value.length > maxArrayLimit) {\n        retval = value\n          .slice(0, maxArrayLimit)\n          .concat([\n            `... extra ${value.length - maxArrayLimit} values truncated ...`,\n          ]);\n      }\n    } else {\n      // Add refinement after Array.isArray call.\n      invariant(typeof value === 'object', 'This was already found earlier');\n      let keys = Object.keys(value);\n      if (stack.length >= maxDepth) {\n        retval = `{ ... object with ${keys.length} keys ... }`;\n      } else if (keys.length > maxObjectKeysLimit) {\n        // Return a sample of the keys.\n        retval = {};\n        for (let k of keys.slice(0, maxObjectKeysLimit)) {\n          retval[k] = value[k];\n        }\n        const truncatedKey = '...(truncated keys)...';\n        retval[truncatedKey] = keys.length - maxObjectKeysLimit;\n      }\n    }\n    stack.unshift(retval);\n    return retval;\n  }\n\n  return function stringifySafe(arg: mixed): string {\n    if (arg === undefined) {\n      return 'undefined';\n    } else if (arg === null) {\n      return 'null';\n    } else if (typeof arg === 'function') {\n      try {\n        return arg.toString();\n      } catch (e) {\n        return '[function unknown]';\n      }\n    } else if (arg instanceof Error) {\n      return arg.name + ': ' + arg.message;\n    } else {\n      // Perform a try catch, just in case the object has a circular\n      // reference or stringify throws for some other reason.\n      try {\n        const ret = JSON.stringify(arg, replacer);\n        if (ret === undefined) {\n          return '[\"' + typeof arg + '\" failed to stringify]';\n        }\n        return ret;\n      } catch (e) {\n        if (typeof arg.toString === 'function') {\n          try {\n            // $FlowFixMe[incompatible-use] : toString shouldn't take any arguments in general.\n            return arg.toString();\n          } catch (E) {}\n        }\n      }\n    }\n    return '[\"' + typeof arg + '\" failed to stringify]';\n  };\n}\n\nconst stringifySafe: mixed => string = createStringifySafeWithLimits({\n  maxDepth: 10,\n  maxStringLimit: 100,\n  maxArrayLimit: 50,\n  maxObjectKeysLimit: 50,\n});\n\nexport default stringifySafe;\n"],"mappings":"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"}