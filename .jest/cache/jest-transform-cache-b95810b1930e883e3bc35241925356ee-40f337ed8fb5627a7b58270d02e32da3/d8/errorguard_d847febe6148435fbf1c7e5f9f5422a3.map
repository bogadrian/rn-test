{"version":3,"names":["_inGuard","_globalHandler","onError","e","isFatal","ErrorUtils","setGlobalHandler","fun","getGlobalHandler","reportError","error","reportFatalError","applyWithGuard","context","args","unused_onError","unused_name","apply","applyWithGuardIfNeeded","inGuard","guard","name","console","warn","guardName","guarded","global"],"sources":["error-guard.js"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @format\n * @flow strict\n * @polyfill\n */\n\nlet _inGuard = 0;\n\ntype ErrorHandler = (error: mixed, isFatal: boolean) => void;\ntype Fn<Args, Return> = (...Args) => Return;\n\n/**\n * This is the error handler that is called when we encounter an exception\n * when loading a module. This will report any errors encountered before\n * ExceptionsManager is configured.\n */\nlet _globalHandler: ErrorHandler = function onError(\n  e: mixed,\n  isFatal: boolean,\n) {\n  throw e;\n};\n\n/**\n * The particular require runtime that we are using looks for a global\n * `ErrorUtils` object and if it exists, then it requires modules with the\n * error handler specified via ErrorUtils.setGlobalHandler by calling the\n * require function with applyWithGuard. Since the require module is loaded\n * before any of the modules, this ErrorUtils must be defined (and the handler\n * set) globally before requiring anything.\n */\nconst ErrorUtils = {\n  setGlobalHandler(fun: ErrorHandler): void {\n    _globalHandler = fun;\n  },\n  getGlobalHandler(): ErrorHandler {\n    return _globalHandler;\n  },\n  reportError(error: mixed): void {\n    _globalHandler && _globalHandler(error, false);\n  },\n  reportFatalError(error: mixed): void {\n    // NOTE: This has an untyped call site in Metro.\n    _globalHandler && _globalHandler(error, true);\n  },\n  applyWithGuard<TArgs: $ReadOnlyArray<mixed>, TOut>(\n    fun: Fn<TArgs, TOut>,\n    context?: ?mixed,\n    args?: ?TArgs,\n    // Unused, but some code synced from www sets it to null.\n    unused_onError?: null,\n    // Some callers pass a name here, which we ignore.\n    unused_name?: ?string,\n  ): ?TOut {\n    try {\n      _inGuard++;\n      /* $FlowFixMe[incompatible-call] : TODO T48204745 (1) apply(context,\n       * null) is fine. (2) array -> rest array should work */\n      /* $FlowFixMe[incompatible-type] : TODO T48204745 (1) apply(context,\n       * null) is fine. (2) array -> rest array should work */\n      return fun.apply(context, args);\n    } catch (e) {\n      ErrorUtils.reportError(e);\n    } finally {\n      _inGuard--;\n    }\n    return null;\n  },\n  applyWithGuardIfNeeded<TArgs: $ReadOnlyArray<mixed>, TOut>(\n    fun: Fn<TArgs, TOut>,\n    context?: ?mixed,\n    args?: ?TArgs,\n  ): ?TOut {\n    if (ErrorUtils.inGuard()) {\n      /* $FlowFixMe[incompatible-call] : TODO T48204745 (1) apply(context,\n       * null) is fine. (2) array -> rest array should work */\n      /* $FlowFixMe[incompatible-type] : TODO T48204745 (1) apply(context,\n       * null) is fine. (2) array -> rest array should work */\n      return fun.apply(context, args);\n    } else {\n      ErrorUtils.applyWithGuard(fun, context, args);\n    }\n    return null;\n  },\n  inGuard(): boolean {\n    return !!_inGuard;\n  },\n  guard<TArgs: $ReadOnlyArray<mixed>, TOut>(\n    fun: Fn<TArgs, TOut>,\n    name?: ?string,\n    context?: ?mixed,\n  ): ?(...TArgs) => ?TOut {\n    // TODO: (moti) T48204753 Make sure this warning is never hit and remove it - types\n    // should be sufficient.\n    if (typeof fun !== 'function') {\n      console.warn('A function must be passed to ErrorUtils.guard, got ', fun);\n      return null;\n    }\n    const guardName = name ?? fun.name ?? '<generated guard>';\n    function guarded(...args: TArgs): ?TOut {\n      return ErrorUtils.applyWithGuard(\n        fun,\n        context ?? this,\n        args,\n        null,\n        guardName,\n      );\n    }\n\n    return guarded;\n  },\n};\n\nglobal.ErrorUtils = ErrorUtils;\n\nexport type ErrorUtilsT = typeof ErrorUtils;\n"],"mappings":"AAWA,IAAIA,QAAQ,GAAG,CAAf;;AAUA,IAAIC,cAA4B,GAAG,SAASC,OAAT,CACjCC,CADiC,EAEjCC,OAFiC,EAGjC;EACA,MAAMD,CAAN;AACD,CALD;;AAeA,IAAME,UAAU,GAAG;EACjBC,gBADiB,4BACAC,GADA,EACyB;IACxCN,cAAc,GAAGM,GAAjB;EACD,CAHgB;EAIjBC,gBAJiB,8BAIgB;IAC/B,OAAOP,cAAP;EACD,CANgB;EAOjBQ,WAPiB,uBAOLC,KAPK,EAOe;IAC9BT,cAAc,IAAIA,cAAc,CAACS,KAAD,EAAQ,KAAR,CAAhC;EACD,CATgB;EAUjBC,gBAViB,4BAUAD,KAVA,EAUoB;IAEnCT,cAAc,IAAIA,cAAc,CAACS,KAAD,EAAQ,IAAR,CAAhC;EACD,CAbgB;EAcjBE,cAdiB,0BAefL,GAfe,EAgBfM,OAhBe,EAiBfC,IAjBe,EAmBfC,cAnBe,EAqBfC,WArBe,EAsBR;IACP,IAAI;MACFhB,QAAQ;MAKR,OAAOO,GAAG,CAACU,KAAJ,CAAUJ,OAAV,EAAmBC,IAAnB,CAAP;IACD,CAPD,CAOE,OAAOX,CAAP,EAAU;MACVE,UAAU,CAACI,WAAX,CAAuBN,CAAvB;IACD,CATD,SASU;MACRH,QAAQ;IACT;;IACD,OAAO,IAAP;EACD,CApCgB;EAqCjBkB,sBArCiB,kCAsCfX,GAtCe,EAuCfM,OAvCe,EAwCfC,IAxCe,EAyCR;IACP,IAAIT,UAAU,CAACc,OAAX,EAAJ,EAA0B;MAKxB,OAAOZ,GAAG,CAACU,KAAJ,CAAUJ,OAAV,EAAmBC,IAAnB,CAAP;IACD,CAND,MAMO;MACLT,UAAU,CAACO,cAAX,CAA0BL,GAA1B,EAA+BM,OAA/B,EAAwCC,IAAxC;IACD;;IACD,OAAO,IAAP;EACD,CApDgB;EAqDjBK,OArDiB,qBAqDE;IACjB,OAAO,CAAC,CAACnB,QAAT;EACD,CAvDgB;EAwDjBoB,KAxDiB,iBAyDfb,GAzDe,EA0Dfc,IA1De,EA2DfR,OA3De,EA4DO;IAAA;;IAGtB,IAAI,OAAON,GAAP,KAAe,UAAnB,EAA+B;MAC7Be,OAAO,CAACC,IAAR,CAAa,qDAAb,EAAoEhB,GAApE;MACA,OAAO,IAAP;IACD;;IACD,IAAMiB,SAAS,WAAGH,IAAH,WAAGA,IAAH,GAAWd,GAAG,CAACc,IAAf,mBAAuB,mBAAtC;;IACA,SAASI,OAAT,GAAwC;MAAA,kCAApBX,IAAoB;QAApBA,IAAoB;MAAA;;MACtC,OAAOT,UAAU,CAACO,cAAX,CACLL,GADK,EAELM,OAFK,WAELA,OAFK,GAEM,IAFN,EAGLC,IAHK,EAIL,IAJK,EAKLU,SALK,CAAP;IAOD;;IAED,OAAOC,OAAP;EACD;AA/EgB,CAAnB;AAkFAC,MAAM,CAACrB,UAAP,GAAoBA,UAApB"}