{"version":3,"names":["defaultColor","r","g","b","a","_uniqueId","processColor","color","undefined","normalizedColor","normalizeColor","processedColorObj","processColorObject","isRgbaValue","value","isRgbaAnimatedValue","AnimatedValue","AnimatedColor","valueIn","rgbaAnimatedValue","rgbaValue","_listeners","setValue","offset","setOffset","flattenOffset","extractOffset","callback","id","String","jointCallback","number","__getValue","addListener","removeListener","removeAllListeners","stopAnimation","resetAnimation","__addChild","__removeChild","AnimatedWithChildren"],"sources":["AnimatedColor.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n * @format\n */\n\n'use strict';\n\nimport AnimatedValue from './AnimatedValue';\nimport AnimatedWithChildren from './AnimatedWithChildren';\nimport normalizeColor from '../../StyleSheet/normalizeColor';\nimport {processColorObject} from '../../StyleSheet/PlatformColorValueTypes';\n\nimport type {ColorValue} from '../../StyleSheet/StyleSheet';\nimport type {NativeColorValue} from '../../StyleSheet/PlatformColorValueTypes';\n\ntype ColorListenerCallback = (value: string) => mixed;\ntype RgbaValue = {\n  +r: number,\n  +g: number,\n  +b: number,\n  +a: number,\n  ...\n};\ntype RgbaAnimatedValue = {\n  +r: AnimatedValue,\n  +g: AnimatedValue,\n  +b: AnimatedValue,\n  +a: AnimatedValue,\n  ...\n};\n\nconst defaultColor: RgbaValue = {r: 0, g: 0, b: 0, a: 1.0};\nlet _uniqueId = 1;\n\n/* eslint no-bitwise: 0 */\nfunction processColor(color?: ?ColorValue): ?(RgbaValue | NativeColorValue) {\n  if (color === undefined || color === null) {\n    return null;\n  }\n\n  let normalizedColor = normalizeColor(color);\n  if (normalizedColor === undefined || normalizedColor === null) {\n    return null;\n  }\n\n  if (typeof normalizedColor === 'object') {\n    const processedColorObj = processColorObject(normalizedColor);\n    if (processedColorObj != null) {\n      return processedColorObj;\n    }\n  } else if (typeof normalizedColor === 'number') {\n    const r = (normalizedColor & 0xff000000) >>> 24;\n    const g = (normalizedColor & 0x00ff0000) >>> 16;\n    const b = (normalizedColor & 0x0000ff00) >>> 8;\n    const a = (normalizedColor & 0x000000ff) / 255;\n\n    return {r, g, b, a};\n  }\n\n  return null;\n}\n\nfunction isRgbaValue(value: any): boolean {\n  return (\n    value &&\n    typeof value.r === 'number' &&\n    typeof value.g === 'number' &&\n    typeof value.b === 'number' &&\n    typeof value.a === 'number'\n  );\n}\n\nfunction isRgbaAnimatedValue(value: any): boolean {\n  return (\n    value &&\n    value.r instanceof AnimatedValue &&\n    value.g instanceof AnimatedValue &&\n    value.b instanceof AnimatedValue &&\n    value.a instanceof AnimatedValue\n  );\n}\n\nexport default class AnimatedColor extends AnimatedWithChildren {\n  r: AnimatedValue;\n  g: AnimatedValue;\n  b: AnimatedValue;\n  a: AnimatedValue;\n  _listeners: {\n    [key: string]: {\n      r: string,\n      g: string,\n      b: string,\n      a: string,\n      ...\n    },\n    ...\n  };\n\n  constructor(valueIn?: ?(RgbaValue | RgbaAnimatedValue | ColorValue)) {\n    super();\n    let value: RgbaValue | RgbaAnimatedValue | ColorValue =\n      valueIn || defaultColor;\n\n    if (isRgbaAnimatedValue(value)) {\n      // $FlowIgnore[incompatible-cast] - Type is verified above\n      const rgbaAnimatedValue: RgbaAnimatedValue = (value: RgbaAnimatedValue);\n      this.r = rgbaAnimatedValue.r;\n      this.g = rgbaAnimatedValue.g;\n      this.b = rgbaAnimatedValue.b;\n      this.a = rgbaAnimatedValue.a;\n    } else {\n      // Handle potential parsable string color or platform color object\n      if (!isRgbaValue(value)) {\n        // $FlowIgnore[incompatible-cast] - Type is verified via conditionals\n        value = processColor((value: ColorValue)) || {r: 0, g: 0, b: 0, a: 1.0};\n        // TODO: support platform color\n      }\n\n      // $FlowIgnore[incompatible-cast] - Type is verified via conditionals\n      const rgbaValue: RgbaValue = (value: RgbaValue);\n      this.r = new AnimatedValue(rgbaValue.r);\n      this.g = new AnimatedValue(rgbaValue.g);\n      this.b = new AnimatedValue(rgbaValue.b);\n      this.a = new AnimatedValue(rgbaValue.a);\n    }\n    this._listeners = {};\n  }\n\n  /**\n   * Directly set the value. This will stop any animations running on the value\n   * and update all the bound properties.\n   */\n  setValue(value: {r: number, g: number, b: number, a: number, ...}): void {\n    this.r.setValue(value.r);\n    this.g.setValue(value.g);\n    this.b.setValue(value.b);\n    this.a.setValue(value.a);\n  }\n\n  /**\n   * Sets an offset that is applied on top of whatever value is set, whether\n   * via `setValue`, an animation, or `Animated.event`. Useful for compensating\n   * things like the start of a pan gesture.\n   */\n  setOffset(offset: {r: number, g: number, b: number, a: number, ...}): void {\n    this.r.setOffset(offset.r);\n    this.g.setOffset(offset.g);\n    this.b.setOffset(offset.b);\n    this.a.setOffset(offset.a);\n  }\n\n  /**\n   * Merges the offset value into the base value and resets the offset to zero.\n   * The final output of the value is unchanged.\n   */\n  flattenOffset(): void {\n    this.r.flattenOffset();\n    this.g.flattenOffset();\n    this.b.flattenOffset();\n    this.a.flattenOffset();\n  }\n\n  /**\n   * Sets the offset value to the base value, and resets the base value to\n   * zero. The final output of the value is unchanged.\n   */\n  extractOffset(): void {\n    this.r.extractOffset();\n    this.g.extractOffset();\n    this.b.extractOffset();\n    this.a.extractOffset();\n  }\n\n  /**\n   * Adds an asynchronous listener to the value so you can observe updates from\n   * animations.  This is useful because there is no way to synchronously read\n   * the value because it might be driven natively.\n   *\n   * Returns a string that serves as an identifier for the listener.\n   */\n  addListener(callback: ColorListenerCallback): string {\n    const id = String(_uniqueId++);\n    const jointCallback = ({value: number}) => {\n      callback(this.__getValue());\n    };\n    this._listeners[id] = {\n      r: this.r.addListener(jointCallback),\n      g: this.g.addListener(jointCallback),\n      b: this.b.addListener(jointCallback),\n      a: this.a.addListener(jointCallback),\n    };\n    return id;\n  }\n\n  /**\n   * Unregister a listener. The `id` param shall match the identifier\n   * previously returned by `addListener()`.\n   */\n  removeListener(id: string): void {\n    this.r.removeListener(this._listeners[id].r);\n    this.g.removeListener(this._listeners[id].g);\n    this.b.removeListener(this._listeners[id].b);\n    this.a.removeListener(this._listeners[id].a);\n    delete this._listeners[id];\n  }\n\n  /**\n   * Remove all registered listeners.\n   */\n  removeAllListeners(): void {\n    this.r.removeAllListeners();\n    this.g.removeAllListeners();\n    this.b.removeAllListeners();\n    this.a.removeAllListeners();\n    this._listeners = {};\n  }\n\n  /**\n   * Stops any running animation or tracking. `callback` is invoked with the\n   * final value after stopping the animation, which is useful for updating\n   * state to match the animation position with layout.\n   */\n  stopAnimation(callback?: (value: string) => void): void {\n    this.r.stopAnimation();\n    this.g.stopAnimation();\n    this.b.stopAnimation();\n    this.a.stopAnimation();\n    callback && callback(this.__getValue());\n  }\n\n  /**\n   * Stops any animation and resets the value to its original.\n   */\n  resetAnimation(callback?: (value: string) => void): void {\n    this.r.resetAnimation();\n    this.g.resetAnimation();\n    this.b.resetAnimation();\n    this.a.resetAnimation();\n    callback && callback(this.__getValue());\n  }\n\n  __getValue(): string {\n    return `rgba(${this.r.__getValue()}, ${this.g.__getValue()}, ${this.b.__getValue()}, ${this.a.__getValue()})`;\n  }\n\n  __attach(): void {\n    this.r.__addChild(this);\n    this.g.__addChild(this);\n    this.b.__addChild(this);\n    this.a.__addChild(this);\n    super.__attach();\n  }\n\n  __detach(): void {\n    this.r.__removeChild(this);\n    this.g.__removeChild(this);\n    this.b.__removeChild(this);\n    this.a.__removeChild(this);\n    super.__detach();\n  }\n}\n"],"mappings":"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"}