{"version":3,"names":["_jsdom","data","require","_fakeTimers","_jestMock","_jestUtil","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","JSDOMEnvironment","config","options","dom","JSDOM","testEnvironmentOptions","html","pretendToBeVisual","resources","userAgent","ResourceLoader","undefined","runScripts","url","testURL","virtualConsole","VirtualConsole","sendTo","console","global","window","document","defaultView","Error","stackTraceLimit","installCommonGlobals","globals","Buffer","errorEventListener","event","userErrorListenerCount","error","process","emit","addEventListener","originalAddListener","originalRemoveListener","removeEventListener","args","apply","moduleMocker","ModuleMocker","timerConfig","idToRef","id","refToId","ref","fakeTimers","LegacyFakeTimers","fakeTimersModern","ModernFakeTimers","dispose","close","getInternalVMContext","module","exports"],"sources":["index.js"],"sourcesContent":["'use strict';\n\nfunction _jsdom() {\n  const data = require('jsdom');\n\n  _jsdom = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _fakeTimers() {\n  const data = require('@jest/fake-timers');\n\n  _fakeTimers = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _jestMock() {\n  const data = require('jest-mock');\n\n  _jestMock = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _jestUtil() {\n  const data = require('jest-util');\n\n  _jestUtil = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\nclass JSDOMEnvironment {\n  constructor(config, options) {\n    _defineProperty(this, 'dom', void 0);\n\n    _defineProperty(this, 'fakeTimers', void 0);\n\n    _defineProperty(this, 'fakeTimersModern', void 0);\n\n    _defineProperty(this, 'global', void 0);\n\n    _defineProperty(this, 'errorEventListener', void 0);\n\n    _defineProperty(this, 'moduleMocker', void 0);\n\n    this.dom = new (_jsdom().JSDOM)(\n      typeof config.testEnvironmentOptions.html === 'string'\n        ? config.testEnvironmentOptions.html\n        : '<!DOCTYPE html>',\n      {\n        pretendToBeVisual: true,\n        resources:\n          typeof config.testEnvironmentOptions.userAgent === 'string'\n            ? new (_jsdom().ResourceLoader)({\n                userAgent: config.testEnvironmentOptions.userAgent\n              })\n            : undefined,\n        runScripts: 'dangerously',\n        url: config.testURL,\n        virtualConsole: new (_jsdom().VirtualConsole)().sendTo(\n          (options === null || options === void 0 ? void 0 : options.console) ||\n            console\n        ),\n        ...config.testEnvironmentOptions\n      }\n    );\n    const global = (this.global = this.dom.window.document.defaultView);\n\n    if (!global) {\n      throw new Error('JSDOM did not return a Window object');\n    } // for \"universal\" code (code should use `globalThis`)\n\n    global.global = global; // Node's error-message stack size is limited at 10, but it's pretty useful\n    // to see more than that when a test fails.\n\n    this.global.Error.stackTraceLimit = 100;\n    (0, _jestUtil().installCommonGlobals)(global, config.globals); // TODO: remove this ASAP, but it currently causes tests to run really slow\n\n    global.Buffer = Buffer; // Report uncaught errors.\n\n    this.errorEventListener = event => {\n      if (userErrorListenerCount === 0 && event.error) {\n        process.emit('uncaughtException', event.error);\n      }\n    };\n\n    global.addEventListener('error', this.errorEventListener); // However, don't report them as uncaught if the user listens to 'error' event.\n    // In that case, we assume the might have custom error handling logic.\n\n    const originalAddListener = global.addEventListener;\n    const originalRemoveListener = global.removeEventListener;\n    let userErrorListenerCount = 0;\n\n    global.addEventListener = function (...args) {\n      if (args[0] === 'error') {\n        userErrorListenerCount++;\n      }\n\n      return originalAddListener.apply(this, args);\n    };\n\n    global.removeEventListener = function (...args) {\n      if (args[0] === 'error') {\n        userErrorListenerCount--;\n      }\n\n      return originalRemoveListener.apply(this, args);\n    };\n\n    this.moduleMocker = new (_jestMock().ModuleMocker)(global);\n    const timerConfig = {\n      idToRef: id => id,\n      refToId: ref => ref\n    };\n    this.fakeTimers = new (_fakeTimers().LegacyFakeTimers)({\n      config,\n      global: global,\n      moduleMocker: this.moduleMocker,\n      timerConfig\n    });\n    this.fakeTimersModern = new (_fakeTimers().ModernFakeTimers)({\n      config,\n      global: global\n    });\n  }\n\n  async setup() {}\n\n  async teardown() {\n    if (this.fakeTimers) {\n      this.fakeTimers.dispose();\n    }\n\n    if (this.fakeTimersModern) {\n      this.fakeTimersModern.dispose();\n    }\n\n    if (this.global) {\n      if (this.errorEventListener) {\n        this.global.removeEventListener('error', this.errorEventListener);\n      }\n\n      this.global.close(); // Dispose \"document\" to prevent \"load\" event from triggering.\n      // Note that this.global.close() will trigger the CustomElement::disconnectedCallback\n      // Do not reset the document before CustomElement disconnectedCallback function has finished running,\n      // document should be accessible within disconnectedCallback.\n\n      Object.defineProperty(this.global, 'document', {\n        value: null\n      });\n    }\n\n    this.errorEventListener = null; // @ts-expect-error\n\n    this.global = null;\n    this.dom = null;\n    this.fakeTimers = null;\n    this.fakeTimersModern = null;\n  }\n\n  getVmContext() {\n    if (this.dom) {\n      return this.dom.getInternalVMContext();\n    }\n\n    return null;\n  }\n}\n\nmodule.exports = JSDOMEnvironment;\n"],"mappings":"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"}