{"version":3,"names":["Object","defineProperty","exports","value","default","_jestUtil","require","FRAMEWORK_INITIALIZER","resolve","jestAdapter","globalConfig","config","environment","runtime","testPath","sendMessageToJest","requireInternalModule","initialize","runAndTransformResultsToJestFormat","localRequire","requireModule","bind","parentProcess","process","setGlobalsForRuntime","globals","snapshotState","fakeTimers","enableGlobally","legacyFakeTimers","useFakeTimers","fakeTimersModern","beforeEach","resetModules","clearMocks","clearAllMocks","resetMocks","resetAllMocks","restoreMocks","restoreAllMocks","setupFilesAfterEnv","path","esm","unstable_shouldLoadAsEsm","unstable_importModule","results","_addSnapshotData","deepCyclicCopy","keepPrototype","testResults","forEach","fullName","status","markSnapshotsAsCheckedForTest","uncheckedCount","getUncheckedCount","uncheckedKeys","getUncheckedKeys","removeUncheckedKeys","save","snapshot","fileDeleted","deleted","added","matched","unmatched","updated","unchecked","Array","from","_default"],"sources":["jestAdapter.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nvar _jestUtil = require('jest-util');\n\n/**\n * Copyright (c) Facebook, Inc. and its affiliates. All Rights Reserved.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nconst FRAMEWORK_INITIALIZER = require.resolve('./jestAdapterInit');\n\nconst jestAdapter = async (\n  globalConfig,\n  config,\n  environment,\n  runtime,\n  testPath,\n  sendMessageToJest\n) => {\n  const {initialize, runAndTransformResultsToJestFormat} =\n    runtime.requireInternalModule(FRAMEWORK_INITIALIZER);\n  const {globals, snapshotState} = await initialize({\n    config,\n    environment,\n    globalConfig,\n    localRequire: runtime.requireModule.bind(runtime),\n    parentProcess: process,\n    sendMessageToJest,\n    setGlobalsForRuntime: runtime.setGlobalsForRuntime.bind(runtime),\n    testPath\n  });\n\n  if (config.fakeTimers.enableGlobally) {\n    if (config.fakeTimers.legacyFakeTimers) {\n      // during setup, this cannot be null (and it's fine to explode if it is)\n      environment.fakeTimers.useFakeTimers();\n    } else {\n      environment.fakeTimersModern.useFakeTimers();\n    }\n  }\n\n  globals.beforeEach(() => {\n    if (config.resetModules) {\n      runtime.resetModules();\n    }\n\n    if (config.clearMocks) {\n      runtime.clearAllMocks();\n    }\n\n    if (config.resetMocks) {\n      runtime.resetAllMocks();\n\n      if (\n        config.fakeTimers.enableGlobally &&\n        config.fakeTimers.legacyFakeTimers\n      ) {\n        // during setup, this cannot be null (and it's fine to explode if it is)\n        environment.fakeTimers.useFakeTimers();\n      }\n    }\n\n    if (config.restoreMocks) {\n      runtime.restoreAllMocks();\n    }\n  });\n\n  for (const path of config.setupFilesAfterEnv) {\n    const esm = runtime.unstable_shouldLoadAsEsm(path);\n\n    if (esm) {\n      await runtime.unstable_importModule(path);\n    } else {\n      runtime.requireModule(path);\n    }\n  }\n\n  const esm = runtime.unstable_shouldLoadAsEsm(testPath);\n\n  if (esm) {\n    await runtime.unstable_importModule(testPath);\n  } else {\n    runtime.requireModule(testPath);\n  }\n\n  const results = await runAndTransformResultsToJestFormat({\n    config,\n    globalConfig,\n    testPath\n  });\n\n  _addSnapshotData(results, snapshotState); // We need to copy the results object to ensure we don't leaks the prototypes\n  // from the VM. Jasmine creates the result objects in the parent process, we\n  // should consider doing that for circus as well.\n\n  return (0, _jestUtil.deepCyclicCopy)(results, {\n    keepPrototype: false\n  });\n};\n\nconst _addSnapshotData = (results, snapshotState) => {\n  results.testResults.forEach(({fullName, status}) => {\n    if (status === 'pending' || status === 'failed') {\n      // if test is skipped or failed, we don't want to mark\n      // its snapshots as obsolete.\n      snapshotState.markSnapshotsAsCheckedForTest(fullName);\n    }\n  });\n  const uncheckedCount = snapshotState.getUncheckedCount();\n  const uncheckedKeys = snapshotState.getUncheckedKeys();\n\n  if (uncheckedCount) {\n    snapshotState.removeUncheckedKeys();\n  }\n\n  const status = snapshotState.save();\n  results.snapshot.fileDeleted = status.deleted;\n  results.snapshot.added = snapshotState.added;\n  results.snapshot.matched = snapshotState.matched;\n  results.snapshot.unmatched = snapshotState.unmatched;\n  results.snapshot.updated = snapshotState.updated;\n  results.snapshot.unchecked = !status.deleted ? uncheckedCount : 0; // Copy the array to prevent memory leaks\n\n  results.snapshot.uncheckedKeys = Array.from(uncheckedKeys);\n};\n\nvar _default = jestAdapter;\nexports.default = _default;\n"],"mappings":"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"}